{% load static %}
{% comment %} {% load myapp.filters %} {% endcomment %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{product.name}}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
    <link rel="stylesheet" href="{% static 'css/product.css' %}" />
</head>

<body>
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container-fluid">
            <a class="navbar-brand" href="{% url "home" %}">SELL-N-BUY</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <b><a class="nav-link active" aria-current="page" href="{% url "cart" %}">Your Cart</a></b>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" style="color: red" href="{% url 'logout' %}">Logout</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link disabled" aria-disabled="true">Hello {{user.first_name}}
                            {{user.last_name}}</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="product-view-container">
        <div class="product-image">
            <img src="{{product.image_field.url}}" alt="{{product.name}}">
            <div class="buttons">
                {% if added == 0 %}
                <button class="add-to-cart" disabled style="background-color:grey;opacity:0.3">Added To Cart</button>
                {% else %}
                <button class="add-to-cart"><a href="{% url "add_product_to_cart" product.code %}">Add to Cart</a></button>
                {% endif %}
                <button class="buy-now">Buy Now</button>
            </div>
        </div>
        <div class="product-details">
            <h1 class="product-name">{{product.name}}</h1>
            <div class="star-rating" id="stars">
            </div>
            <p class="description">{{product.desc}}</p>
            <p class="price">Price: ₹{{product.price}}</p>
            <p class="sold-by">Sold by: {{product.seller.user.first_name}} {{product.seller.user.last_name}}</p>

            <!-- progress bars  -->

            <div class="progress" style="height: 25px;" role="progressbar" aria-label="Success example"
                aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">
                <div class="progress-bar bg-success" style="width: {{ratings.0}}%">5 Stars</div>
            </div>

            <div class="progress" style="height: 25px;" role="progressbar" aria-label="Info example" aria-valuenow="50"
                aria-valuemin="0" aria-valuemax="100">
                <div class="progress-bar bg-info" style="width: {{ratings.1}}%">4 Stars</div>
            </div>

            <div class="progress" style="height: 25px;" role="progressbar" aria-label="Warning example"
                aria-valuenow="75" aria-valuemin="0" aria-valuemax="100">
                <div class="progress-bar bg-warning" style="width: {{ratings.2}}%">3 Stars</div>
            </div>
            
            <div class="progress" style="height: 25px;" role="progressbar" aria-label="Danger example"
            aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">
            <div class="progress-bar bg-warning" style="width: {{ratings.3}}%,background-color: rgb(224, 129, 5);">2 Stars</div>
        </div>
                
            <div class="progress" style="height: 25px;" role="progressbar" aria-label="Danger example"
                aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">
                <div class="progress-bar bg-danger" style="width: {{ratings.4}}%">1 Stars</div>
            </div>
        </div>
    </div>
    <!-- reviews below : -->
    <div class="review-section">
        <h4>Reviews</h4>
        {% if ratings == "no reviews yet" %}
            <h5 style="opacity:0.5">Be the first one to review.</h5>
        {% else %}
        {% for review in reviews %}
        <div class="review-card">
            <div class="rating">
                {{review.stars}}</div>
            <div class="reviewer">By - {{review.provider.user.first_name}} {{review.provider.user.last_name}}</div>
            <div class="review-statement">{{review.review}}</div>
            <div class="date">{{review.date.day}} <span class = "monthnum">{{review.date.month}}</span> {{months.review.date.month}} {{review.date.year}}</div>
        </div>
        {% endfor %}
        {% endif %}
    </div>
    <div class="add-review-section">
        <h4>Add a Review</h4>
        <form id="review-form" method="post">
            {% csrf_token %}
            <div class="form-group">
                <label for="rating">Rating:</label>
                <select id="rating" name="rating">
                    <option value="5">⭐⭐⭐⭐⭐</option>
                    <option value="4">⭐⭐⭐⭐</option>
                    <option value="3">⭐⭐⭐</option>
                    <option value="2">⭐⭐</option>
                    <option value="1">⭐</option>
                </select>
            </div>
            <div class="form-group">
                <label for="review-statement">Review Statement:</label>
                <textarea id="review-statement" name="review-statement" rows="4"></textarea>
            </div>
            <button type="submit">Submit</button>
        </form>
    </div>

</body>
    <script>
        {% comment %} the actual rating of the product {% endcomment %}
        function starRating(n) {
            var starsElement = document.getElementById("stars");
            if (n === 0){
                starsElement.innerHTML = "<p>No ratings yet</p>";
            }else{
                starsElement.innerHTML = "⭐".repeat(n);
            }
          }
          
          starRating({{avg_rating}});
          
          {% comment %} replace the stars no. with actual stars {% endcomment %}

          function replaceNumbersWithStars() {
            var divs = document.getElementsByClassName('rating');
            for (var i = 0; i < divs.length; i++) {
                var number = parseInt(divs[i].textContent);
                var stars = '⭐'.repeat(number);
                divs[i].textContent = stars;
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            replaceNumbersWithStars();
        });

        {% comment %} replace the month with name of the month {% endcomment %}

        var months_list = ['January','February','March','April','May','June','July','August','September','October','November','December']

        function replaceNumbersWithMonth() {
            var divs = document.getElementsByClassName('monthnum');
            for (var i = 0; i < divs.length; i++) {
                var number = parseInt(divs[i].textContent);
                var month = months_list[number-1];
                divs[i].textContent = month;
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            replaceNumbersWithMonth();
        });


    </script>
</html>